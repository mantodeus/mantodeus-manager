!lm4KuaadW

# ========================================
# SIMPLE DEPLOYMENT WORKFLOW (Recommended)
# ========================================

# 1. Build locally (for testing)
.\scripts\build-local.ps1
.\scripts\build-local.ps1 -SkipInstall  # Skip install if deps haven't changed

# 2. SSH to server and deploy
ssh mantodeus
cd /srv/customer/sites/manager.mantodeus.com
git pull origin main
bash scripts/deploy-manual.sh  # Runs in background, safe to disconnect

# Monitor progress (optional):
tail -f deploy-*.log

# ========================================
# OLD WORKFLOW (with upload - has SSH issues)
# ========================================

.\scripts\build-and-upload.ps1
.\scripts\build-and-upload.ps1 -SkipInstall

cd /srv/customer/sites/manager.mantodeus.com

cd /srv/customer/sites/manager.mantodeus.com
git fetch origin
git pull origin main
npx pnpm install
npx pnpm drizzle-kit migrate
npx pnpm install --frozen-lockfile
npx pnpm run build
npx pm2 restart mantodeus-manager

npx pm2 start dist/index.js --name mantodeus-manager
npx pm2 save

npx pm2 stop mantodeus-manager
npx pm2 start ecosystem.config.js

mysql -u bm9k66_mantodeus -p -h bm9k66.myd.infomaniak.com bm9k66_mantodeus_manager

bash infra/deploy/deploy.sh

git reset --hard origin/main

git checkout main
git pull
git merge back
git merge front
git push

npx pm2 logs mantodeus-manager --lines 200

set +H
export DATABASE_URL='mysql://bm9k66_mantodeus:!lm4KuaadW@bm9k66.myd.infomaniak.com:3306/bm9k66_mantodeus_manager'
npx pnpm drizzle-kit migrate
